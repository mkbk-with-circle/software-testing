Deleting elements from a list while iterating can cause unexpected results