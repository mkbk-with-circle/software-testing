Infinite loop due to incorrect while loop condition